# 架构设计（渐进式）

本项目采用“**整洁架构（Clean Architecture）+ 模块化单体（Modular Monolith）**”的组合方式：

- `infrastructure`：技术细节与适配（Web/Security/DB/Cache/OpenAPI/配置等）
- `features`：业务功能（每个功能自带 `domain/data/presentation` 分层）

## 包结构约定

- `indi.midreamsheep.vegetable.backend`
  - `common`：通用横切能力（不承载具体业务规则）
    - `api`：统一响应体等
    - `error`：错误码、业务异常
    - `web`：全局异常映射、Web 层通用配置
  - `infrastructure`：技术适配与配置（MyBatis-Plus、Redis、JWT、OpenAPI 等）
  - `features.*`：业务功能模块（建议一功能一包）
    - `domain`：业务规则与领域服务
      - `port`：领域依赖的“出口”（接口），由 `data` 或 `infrastructure` 实现
    - `data`：数据访问与外部资源适配（MySQL/MyBatis、Redis 等）
    - `presentation`：接口层（Controller + 请求/响应 DTO）

## 分层依赖方向

推荐依赖方向（箭头表示“可以依赖”）：

`presentation` → `domain` → `domain/port` ← `data` / `infrastructure`

约束与建议：

- `presentation` 只处理 HTTP 相关（路由、参数校验、鉴权上下文提取），调用领域服务完成用例。
- `domain` 放业务规则，尽量保持对 Spring/框架的“低侵入”。
- `domain/port` 定义领域对外部能力的依赖（例如：token、缓存、持久化、第三方调用）。
- `data`/`infrastructure` 负责实现这些端口（DB/Redis/HTTP/JWT 等）。

## API 约定

- 统一前缀：`/api/v1`
- 统一响应体：`ApiResponse{ code, message, data }`
- 错误码为稳定整数：见 `common/error/ErrorCode`
